<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso Restrito - Painel de Prazos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; transition: background 0.8s ease; overflow-x: hidden; }
        .perspectiva { perspective: 1000px; }
        .preservar-3d { transform-style: preserve-3d; transition: transform 0.1s ease-out; }
        .saltar-fora { transform: translateZ(50px); }
        #shackle { transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); }
        .unlocked #shackle { transform: translateY(-6px); }
        
        /* Animação de tremor para erro */
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .erro-shake { animation: shake 0.2s ease-in-out 0s 2; }
    </style>
</head>
<body id="body-bg" class="min-h-screen flex items-center justify-center p-4 perspectiva">
    
    <div id="painel-login" class="w-full max-w-md relative z-10 mx-auto preservar-3d">
        <div class="text-center mb-6 sm:mb-8 saltar-fora">
            <div id="icon-bg" class="w-20 h-20 sm:w-24 sm:h-24 rounded-full mx-auto flex items-center justify-center mb-4 sm:mb-6 transition-all">
                <svg id="lock-icon" xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 sm:h-12 sm:w-12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                    <path id="shackle" d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                </svg>
            </div>
            <h2 id="titulo-login">Acesso Restrito</h2>
            <p id="subtitulo-login" class="mt-2 text-xs sm:text-sm">Área de Segurança Máxima</p>
        </div>

        <div id="captcha-area" class="hidden flex flex-col items-center justify-center space-y-4 p-6 bg-black/20 rounded-2xl border-2 border-white/30 mb-6 saltar-fora">
            <p class="text-white font-black uppercase text-xs tracking-tighter">Verificação de Segurança: Clique nas bolas na cor <span id="target-color-name" class="underline">...</span></p>
            <div class="flex gap-4 justify-center" id="balls-container">
                </div>
        </div>
        
        <div id="alerta-erro" class="hidden mb-6 p-4 rounded-xl text-xs sm:text-sm text-center font-bold saltar-fora"></div>

        <form id="form-login" action="/fazer-login" method="POST" class="space-y-4 sm:space-y-6">
            <div class="saltar-pouco">
                <label id="label-user">Usuário</label>
                <input type="text" name="usuario" id="input-usuario" required class="w-full outline-none transition-all">
            </div>
            <div class="saltar-pouco">
                <label id="label-pass">Senha</label>
                <input type="password" name="senha" id="input-senha" required class="w-full outline-none transition-all">
            </div>
            <div class="saltar-fora pt-2">
                <button type="button" id="btn-pre-auth" class="w-full font-black py-4 transition-all">
                    Verificar Identidade
                </button>
                <button type="submit" id="btn-final" class="hidden w-full font-black py-4 transition-all">
                    Entrar no Sistema
                </button>
            </div>
        </form>
    </div>

    <script>
        // Design do Painel 
        const designs = [
            { body: "bg-slate-950", panel: "bg-slate-900 p-8 rounded-3xl border-2 border-cyan-500 shadow-[0_0_30px_rgba(6,182,212,0.3)]", iconBg: "bg-cyan-500 text-slate-900", btn: "bg-cyan-500 text-slate-950 rounded-xl", input: "bg-slate-800 border-2 border-slate-700 p-3 rounded-lg text-cyan-400" },
            { body: "bg-rose-950", panel: "bg-white p-8 rounded-[2rem] border-4 border-black shadow-[10px_10px_0_#000]", iconBg: "bg-yellow-400 text-black border-4 border-black", btn: "bg-rose-500 text-white border-4 border-black shadow-[4px_4px_0_#000] hover:shadow-none", input: "bg-white border-4 border-black p-3 rounded-none text-black font-bold" }
        ];

        const tema = designs[Math.floor(Math.random() * designs.length)];
        document.body.className += " " + tema.body;
        document.getElementById('painel-login').className += " " + tema.panel;
        document.getElementById('icon-bg').className += " " + tema.iconBg;
        document.getElementById('input-usuario').className += " " + tema.input;
        document.getElementById('input-senha').className += " " + tema.input;
        document.getElementById('btn-pre-auth').className += " " + tema.btn;
        document.getElementById('btn-final').className += " " + tema.btn;

        const painel = document.getElementById('painel-login');
        document.addEventListener('mousemove', (e) => {
            let x = (window.innerWidth / 2 - e.pageX) / 30;
            let y = (window.innerHeight / 2 - e.pageY) / 30;
            painel.style.transform = `rotateY(${x}deg) rotateX(${y}deg)`;
        });

        window.onload = () => {
    // Verifica se tem erro na URL
    const urlParams = new URLSearchParams(window.location.search);
    const erro = urlParams.get('erro');
    const areaCaptcha = document.getElementById('captcha-container'); // Ou o ID onde quer mostrar o erro

    if (erro === 'bloqueado') {
        alert("⛔ ACESSO BLOQUEADO TEMPORARIAMENTE\n\nMuitas tentativas falhas. Aguarde 15 minutos.");
        // Opcional: Desabilitar o formulário visualmente
        document.body.style.opacity = "0.5";
        document.body.style.pointerEvents = "none";
    } else if (erro === 'senha') {
        alert("❌ Usuário ou senha incorretos.");
    }
};

        // Lógica do CAPTCHA "Jogo das Bolas"
        const btnPreAuth = document.getElementById('btn-pre-auth');
        const btnFinal = document.getElementById('btn-final');
        const captchaArea = document.getElementById('captcha-area');
        const ballsContainer = document.getElementById('balls-container');
        const targetColorName = document.getElementById('target-color-name');

        const cores = [
            { nome: 'Verde', hex: 'bg-green-500' },
            { nome: 'Azul', hex: 'bg-blue-500' },
            { nome: 'Amarelo', hex: 'bg-yellow-400' }
        ];

        btnPreAuth.addEventListener('click', () => {
            if(!document.getElementById('input-usuario').value || !document.getElementById('input-senha').value) {
                alert("Preencha as credenciais primeiro!");
                return;
            }
            
            btnPreAuth.classList.add('hidden');
            captchaArea.classList.remove('hidden');
            gerarCaptcha();
        });

        function gerarCaptcha() {
            ballsContainer.innerHTML = '';
            const corCerta = cores[Math.floor(Math.random() * cores.length)];
            targetColorName.textContent = corCerta.nome;
            targetColorName.style.color = corCerta.hex.replace('bg-', '');

            // Gera 4 bolas
            for(let i = 0; i < 4; i++) {
                const corSorteada = cores[Math.floor(Math.random() * cores.length)];
                const bola = document.createElement('div');
                bola.className = `w-12 h-12 rounded-full cursor-pointer shadow-lg hover:scale-110 transition-transform ${corSorteada.hex}`;
                
                bola.onclick = () => {
                    if(corSorteada.nome === corCerta.nome) {
                        bola.style.display = 'none';
                        vencerCaptcha();
                    } else {
                        captchaArea.classList.add('erro-shake');
                        setTimeout(() => captchaArea.classList.remove('erro-shake'), 400);
                        gerarCaptcha(); 
                    }
                };
                ballsContainer.appendChild(bola);
            }
        }

        function vencerCaptcha() {
            captchaArea.innerHTML = "✅ Humano Detectado!";
            captchaArea.className = "mb-6 p-4 bg-green-500/20 border-2 border-green-500 text-green-500 font-black rounded-xl text-center";
            btnFinal.classList.remove('hidden');
        }

        // Envio Final
        const form = document.getElementById('form-login');
        form.onsubmit = (e) => {
            e.preventDefault();
            document.getElementById('lock-icon').classList.add('unlocked');
            setTimeout(() => form.submit(), 800);
        };
    </script>
</body>
</html>